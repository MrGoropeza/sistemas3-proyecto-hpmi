<form [formGroup]="formComprobante">

  <div class="flex gap-3">
    <div class="field flex flex-column">
      <label class="font-bold" for="proveedor">Proveedor</label>
      <p-dropdown
        inputId="proveedor"
        [options]="proveedores"
        placeholder="Seleccionar"
        formControlName="proveedor"
        optionLabel="nombre"
        name="proveedor"
      >
        <ng-template let-option pTemplate="item">
          {{ option.nombre }}
        </ng-template>
      </p-dropdown>
      <small
        class="p-error"
        *ngIf="
          formComprobante.controls['proveedor'].invalid &&
          formComprobante.controls['proveedor'].touched
        "
        >Proveedor requerido.</small
      >
    </div>
  
    <div class="field flex flex-column" *ngIf="idTipoComprobante === 1">
      <label class="font-bold" for="tipoFactura">Tipo de Factura</label>
      <p-dropdown
        inputId="tipoFactura"
        [options]="tiposFactura"
        placeholder="Seleccionar"
        formControlName="tipoFactura"
        name="tipoFactura"
      >
        <ng-template let-option pTemplate="item">
          {{ option }}
        </ng-template>
      </p-dropdown>
      <small
        class="p-error"
        *ngIf="
          formComprobante.controls['tipoFactura'].invalid &&
          formComprobante.controls['tipoFactura'].touched
        "
        >Tipo de Factura requerida.</small
      >
    </div>
  </div>
  

</form>

<div class="grid">
  <div class="md:col col-12">
    <h4 class="m-0 mb-2 p-0 font-bold">Artículos Disponibles:</h4>
    <app-seleccionar-articulos
      (articuloSeleccionado)="articuloSeleccionado($event)"
    ></app-seleccionar-articulos>
  </div>

  <div class="md:col col-12" *ngIf="articulosSeleccionados.length > 0">
    <div class="flex flex-column">
      <h4 class="m-0 mb-2 p-0 font-bold">Artículos Seleccionados:</h4>

      <p-table [value]="articulosSeleccionados" responsiveLayout="stack"
        dataKey="id">
        <ng-template pTemplate="header" let-columns>
          <tr>
            <th>Id. Artículo</th>
            <th pSortableColumn="nombre">
              Nombre <p-sortIcon field="nombre"></p-sortIcon>
            </th>
            <th>Descripción</th>
            <th>Cantidad</th>
            <th>Precio</th>
            <th>Acción</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-articulo let-columns="columns">
          <tr>
            <td>
              <span class="p-column-title font-bold">Id. Artículo</span
              >{{ articulo.id }}
            </td>
            <td>
              <span class="p-column-title font-bold">Nombre</span
              >{{ articulo.nombre }}
            </td>
            <td>
              <span class="p-column-title font-bold">Descripción</span
              >{{ articulo.descripcion }}
            </td>
            <td>
              <span class="p-column-title font-bold">Cantidad</span>
              <div class="field flex flex-column">
                <input #inputCant id="cantidad" type="number" pInputText min="0"
                    placeholder="Cantidad del artículo" [(ngModel)]="articulo.cantidad"
                    (change)="actualizarSubtotal()"/>
                <small class="p-error"
                    *ngIf="!articulo.cantidad && articulo.cantidad <= 0">Cantidad requerida mayor a 0.</small>
            </div>
            </td>
            <td>
              <span class="p-column-title font-bold">Precio</span>
              <div class="field flex flex-column">
                <input #inputCant id="precio" type="number" pInputText min="0"
                    placeholder="Precio del artículo" [(ngModel)]="articulo.precio"
                    (change)="actualizarSubtotal()"/>
                <small class="p-error"
                    *ngIf="!articulo.precio && articulo.precio <= 0">Precio requerido mayor a 0.</small>
            </div>
            </td>
            <td>
              <span class="p-column-title font-bold">Acción</span>
              <button
                pButton
                pRipple
                tooltipPosition="top"
                pTooltip="Eliminar"
                icon="pi pi-trash"
                class="p-button-rounded p-button-danger mr-2"
                (click)="quitarArticulo(articulo)"
              ></button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>

<!-- <p>{{ formComprobante.value | json }}</p> -->

<div class="flex justify-content-end">
  <p class="m-0 mb-2 p-0 font-bold text-lg">Subtotal: {{ subtotal | currency }}</p>
</div>

<div class="flex justify-content-end">
  <button
    pButton
    pRipple
    type="button"
    label="Cancelar"
    icon="pi pi-times"
    class="p-button-text"
    (click)="cerrar()"
  ></button>

  <button
    pButton
    type="button"
    pRipple
    label="Guardar"
    icon="pi pi-check"
    class="p-button-text"
    (click)="guardar()"
  ></button>
</div>
